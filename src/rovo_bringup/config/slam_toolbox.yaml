slam_toolbox:
  ros__parameters:
    # 1. TIME & MODES
    use_sim_time: false         # Set to 'true' only if playing a rosbag or using Gazebo
    mode: "mapping"             # 'mapping' = Build a new map. 'localization' = Use existing map.
    
    # 2. FRAMES (Must match your 'view_frames' output)
    map_frame: "map"
    odom_frame: "odom"
    base_frame: "base_footprint" # CHANGED: Connects to the root of your robot (better than base_link)
    
    # 3. TF PUBLISHING
    publish_tf: true            # SLAM must publish 'map -> odom'
    provide_odom_frame: false   # FALSE because your Controller already publishes 'odom -> base'
    
    # 4. SENSOR DATA
    scan_topic: "/scan" 
    scan_subscribe_best_effort: true        # FIXED: Was '/nano_scan/scan', now matches your real topic
    scan_queue_size: 10
    
    # 5. MAPPING PARAMS
    resolution: 0.05
    map_update_interval: 1.0    # Faster updates for smoother visualization
    transform_publish_period: 0.05
    minimum_travel_distance: 0.1
    minimum_travel_heading: 0.1
    
    # 6. SOLVER (Standard settings)
    solver_plugin: solver_plugins::CeresSolver
    ceres_linear_solver: SPARSE_NORMAL_CHOLESKY
    ceres_preconditioner: SCHUR_JACOBI
    ceres_trust_strategy: LEVENBERG_MARQUARDT
    ceres_loss_function: None

    # 7. RELIABILITY (Crucial for real hardware)
    # If your lidar is "Best Effort", these ensure SLAM can hear it.
    scan_subscribe_best_effort: true